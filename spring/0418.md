DispatcherServlet

spring container = web application container

| êµ¬ì„± ìš”ì†Œ | ì—­í•  |
| --- | --- |
| Web Application Container | "ê±´ë¬¼ì˜ ê²½ë¹„ ì•„ì €ì”¨" â€“ ìš”ì²­ì„ Springì—ê²Œ ë„˜ê²¨ì¤Œ |
| DispatcherServlet | "ì ‘ìˆ˜ì²˜ ì§ì›" â€“ ìš”ì²­ ë‚´ìš©ì„ ë¶„ë¥˜í•˜ê³  ì „ë‹¬ |
| Spring Container | "ë‚´ë¶€ ì§ì›ë“¤" â€“ ì§„ì§œ ì¼í•˜ëŠ” ì‚¬ëŒë“¤ (Controller, Service ë“±) |

- SampleController.java

ex06 ì¶”ê°€

```java

```


`<form method="post" enctype="multipart/form-data">` : **íŒŒì¼ ì—…ë¡œë“œ**í•  ë•Œ ì‚¬ìš© (ex. ì´ë¯¸ì§€, PDF)

AOPë€?

AOPëŠ” **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ìƒê´€ì—†ëŠ” ê³µí†µ ê´€ì‹¬ì‚¬(ê³µí†µ ê¸°ëŠ¥)**ë¥¼ **í•µì‹¬ ë¡œì§ì—ì„œ ë¶„ë¦¬í•´ì„œ ì²˜ë¦¬**í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í”„ë¡œê·¸ë˜ë° ë°©ì‹

> ğŸ¯ í•µì‹¬ ì•„ì´ë””ì–´:
> 
> 
> "ê³µí†µì ì¸ ì½”ë“œ(ë¡œê·¸ ì¶œë ¥, ë³´ì•ˆ, íŠ¸ëœì­ì…˜ ë“±)ë¥¼ ë”°ë¡œ ë¹¼ì„œ ê¹”ë”í•˜ê²Œ ê´€ë¦¬í•˜ì!"
> 

Oracle SQL Developer:agent

```sql
create sequence seq_board;

create table tbl_board (
  bno number(10,0),
  title varchar2(200) not null,
  content varchar2(2000) not null,
  writer varchar2(50) not null,
  regdate date default sysdate, 
  updatedate date default sysdate
);

alter table tbl_board add constraint pk_board 
primary key (bno);

insert into tbl_board(bno, title, content, writer)
  values(seq_board.nextval, 'í…ŒìŠ¤íŠ¸ ì œëª©', 'í…ŒìŠ¤íŠ¸ ë‚´ìš©', 'user00');

commmit;
```

- BoardVO.java

```java
package org.zerock.domain;

import java.util.Date;

import lombok.Data;

@Data
public class BoardVO {

  private Long bno;
  private String title;
  private String content;
  private String writer;
  private Date regdate;
  private Date updateDate;
}
```


- BoardMapper.java(interface)

```java
package org.zerock.mapper;

import java.util.List;

import org.zerock.domain.BoardVO;
//import org.zerock.domain.Criteria;

public interface BoardMapper {

	public List<BoardVO> getList();

//	public List<BoardVO> getListWithPaging(Criteria cri);

	public void insert(BoardVO board);

	public Integer insertSelectKey(BoardVO board);

	public BoardVO read(Long bno);

	public int delete(Long bno);

	public int update(BoardVO board);

//	public int getTotalCount(Criteria cri);
}

```


- BoardMapper.xml

```sql
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.zerock.mapper.BoardMapper">

	<sql id="criteria">
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<foreach item='type' collection="typeArr">
				<trim prefix="OR">
					<choose>
						<when test="type == 'T'.toString()">
							title like '%'||#{keyword}||'%'
						</when>
						<when test="type == 'C'.toString()">
							content like '%'||#{keyword}||'%'
						</when>
						<when test="type == 'W'.toString()">
							writer like '%'||#{keyword}||'%'
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>
	</sql>

	<select id="getList" resultType="org.zerock.domain.BoardVO">
	<!-- cdata section : XMLì—ì„œ íŠ¹ìˆ˜ ë¬¸ì(ì˜ˆ: <, >, &)ë¥¼ ê·¸ëƒ¥ ë¬¸ìë¡œ ì¸ì‹í•˜ê²Œ í•´ì£¼ëŠ” ì˜ì—­-->
	<![CDATA[
		select * from tbl_board where bno > 0 
		]]>
	</select>

	<insert id="insert">
		insert into tbl_board (bno,title,content,writer)
		values (seq_board.nextval, #{title}, #{content}, #{writer})
	</insert>

<!--  board ë„˜ì–´ì˜´ íŒŒë¼ë¯¸í„° ìƒëµëœê±°ì„ ê·¸ boardì˜ bnoë¥¼ ì •í•¨ -->
	<insert id="insertSelectKey">

		<selectKey keyProperty="bno" order="BEFORE"
			resultType="long">
			select seq_board.nextval from dual
		</selectKey>

		<!-- ê¸€ì“°ê³  ê¸€ë²ˆí˜¸ë¥¼ ì•Œê³ ì‹¶ë‹¤. -->
		insert into tbl_board (bno,title,content, writer)
			values (#{bno},#{title}, #{content}, #{writer})
	</insert>
<!-- resultType="org.zerock.domain.BoardVO" ë³€ìˆ˜ëª… ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•´ì•¼í•¨ 
í’€ë„¤ì„ì“°ëŠ”ì´ìœ  : mybatisëŠ” config.xml aliasê°€ ìˆì–´ì„œ ì§§ê²Œ ê°€ëŠ¥í–ˆëŠ”ë° ì§€ê¸ˆ mybatisëŠ” config.xmlìƒëµí–‡ìŒ 
ê·¸ë˜ì„œ aliasë¥¼ ëŒ€ì‹  ì„¤ì •í•  ê³³ì´ ì—†ìŒ  ê·¸ë˜ì„œ í’€ë„¤ì„ ì¨ì•¼ í•¨ -->
	<select id="read" resultType="org.zerock.domain.BoardVO">
		select * from tbl_board where bno =
		#{bno}
	</select>

	<delete id="delete">
		delete tbl_board where bno = #{bno}
	</delete>

	<update id="update">
		update tbl_board
		set title= #{title},
		content=#{content},
		writer = #{writer},
		updateDate = sysdate
		where bno =
		#{bno}
	</update>

	<!-- <select id="getListWithPaging" resultType="org.zerock.domain.BoardVO"> 
		<![CDATA[ select bno, title, content, writer, regdate, updatedate from ( 
		select /*+INDEX_DESC(tbl_board pk_board) */ rownum rn, bno, title, content, 
		writer, regdate, updatedate from tbl_board where rownum <= #{pageNum} * #{amount} 
		) where rn > (#{pageNum} -1) * #{amount} ]]> </select> -->

	<select id="getListWithPaging"
		resultType="org.zerock.domain.BoardVO">
  <![CDATA[
  select 
    bno, title, content, writer, regdate, updatedate
  from 
      (
      select /*+INDEX_DESC(tbl_board pk_board) */
        rownum rn, bno, title, content, writer, regdate, updatedate 
      from 
        tbl_board
      where 
  ]]>
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<foreach item='type' collection="typeArr">
				<trim prefix="OR">
					<choose>
						<when test="type == 'T'.toString()">
							title like '%'||#{keyword}||'%'
						</when>
						<when test="type == 'C'.toString()">
							content like '%'||#{keyword}||'%'
						</when>
						<when test="type == 'W'.toString()">
							writer like '%'||#{keyword}||'%'
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>
      
  <![CDATA[    
      rownum <= #{pageNum} * #{amount}
      )
  where rn > (#{pageNum} -1) * #{amount}   
  ]]>
	</select>

	<select id="getTotalCount" resultType="int">
		select count(*) from tbl_board where 
		
		<include refid="criteria"></include> 
		
		bno > 0
		
	</select>

</mapper>

```



```sql
package org.zerock.mapper;

import static org.junit.Assert.*;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import org.zerock.domain.BoardVO;
import org.zerock.sample.DataSourceTests;

import lombok.extern.log4j.Log4j;
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration("file:src/main/webapp/WEB-INF/spring/root-context.xml")
@Log4j
public class BoardMapperTests {
	
	@Autowired
	private BoardMapper mapper;
	
//	@Test
//	public void testInsert() {
//		BoardVO board = new BoardVO();
//		board.setTitle("ìƒˆë¡œìš´ê¸€3");
//		board.setContent("ìƒˆë¡œì‘ì„±í•œê¸€3");
//		board.setWriter("newUser3");
//		
////		mapper.insert(board);
//		
////		INFO : org.zerock.mapper.BoardMapperTests - BoardVO(bno=3, title=ìƒˆë¡œìš´ê¸€3, content=ìƒˆë¡œì‘ì„±í•œê¸€3, writer=newUser3, regdate=null, updateDate=null)
////		bno=3ì´ ë“¤ì–´ê°€ ìˆìŒ
//		mapper.insertSelectKey(board);
//		log.info(board);
//	}
	
	
	
//	|----|------|--------|---------|----------------------|----------------------|
//	|bno |title |content |writer   |regdate               |updatedate            |
//	|----|------|--------|---------|----------------------|----------------------|
//	|3   |ìƒˆë¡œìš´ê¸€3 |ìƒˆë¡œì‘ì„±í•œê¸€3 |newUser3 |2025-04-18 11:46:16.0 |2025-04-18 11:46:16.0 |
//	|----|------|--------|---------|----------------------|----------------------|
//	@Test
//	public void testRead() {
//		BoardVO board = mapper.read(3L);
//		log.info(board);
//	}
	
	
//	INFO : org.zerock.mapper.BoardMapperTests - Delete count: 1
//	@Test
//	public void testDelete() {
//		log.info("Delete count: " + mapper.delete(3L));
//	}
	
	
	
//	INFO : org.zerock.mapper.BoardMapperTests - update count: 1
	@Test
	public void testUpdate() {
		BoardVO board = new BoardVO();
		board.setBno(2L);
		board.setTitle("ìˆ˜ì •ëœ ì œëª©");
		board.setContent("ìˆ˜ì •ëœ ë‚´ìš©");
		board.setWriter("user00");
		
		int count = mapper.update(board);
		log.info("update count: " + count);
	}
}
```

| ë¹„êµ | Spring Legacy | Spring Boot |
| --- | --- | --- |
| ì„¤ì • | XML ê¸°ë°˜ | ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ (ìë™ ì„¤ì •) |
| ë³µì¡ë„ | ì„¤ì • ë§ê³  ë³µì¡ | ê°„ë‹¨í•˜ê³  ë¹ ë¥¸ ì„¤ì • |
| ì‹¤í–‰ | ì›¹ì„œë²„ í•„ìš” (Tomcat) | ë‚´ì¥ Tomcatìœ¼ë¡œ ë°”ë¡œ ì‹¤í–‰ |

```sql
[Service/Controller]
     â†“
[BoardMapper.java (ì¸í„°í˜ì´ìŠ¤)]
     â†“
[BoardMapper.xml (SQL ë§¤í•‘)]
     â†“
[DBë¡œ ì¿¼ë¦¬ ì „ì†¡ / ê²°ê³¼ ë°›ê¸°]
```


- BoardService.java

```java
package org.zerock.service;

import java.util.List;

import org.zerock.domain.BoardVO;
//import org.zerock.domain.Criteria;

public interface BoardService {

	public void register(BoardVO board);

	public BoardVO get(Long bno);

	public boolean modify(BoardVO board);

	public boolean remove(Long bno);

	 public List<BoardVO> getList();

//	public List<BoardVO> getList(Criteria cri);

	//ì¶”ê°€
//	public int getTotal(Criteria cri);

}

```

- BoardServiceImpl.java

```java
package org.zerock.service;

import java.util.List;

import org.springframework.stereotype.Service;
import org.zerock.domain.BoardVO;
import org.zerock.mapper.BoardMapper;

import lombok.AllArgsConstructor;
import lombok.extern.log4j.Log4j;

@Service
@Log4j
@AllArgsConstructor
//@Autowiredë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ì´ìœ ëŠ” ë°”ë¡œ í´ë˜ìŠ¤ì— ë¶™ì€ @AllArgsConstructor ë•Œë¬¸
//@AllArgsConstructor ë•ë¶„ì— ìŠ¤í”„ë§ì´ ìƒì„±ì í†µí•´ ìë™ ì£¼ì…í•´ì¤ë‹ˆë‹¤.
//ìƒì„±ìê°€ 1ê°œì´ê¸° ë•Œë¬¸ì— @Autowired ìƒëµ ê°€ëŠ¥í•˜ê³ ,
//ì‹¤ë¬´ì—ì„œë„ ë§ì´ ì‚¬ìš©í•˜ëŠ” **"ìƒì„±ì ì£¼ì… ë°©ì‹"**ì…ë‹ˆë‹¤.
public class BoardServiceImpl implements BoardService {
	
	private BoardMapper mapper;

	@Override
	public void register(BoardVO board) {
		log.info("register.......");
		mapper.insertSelectKey(board);

	}
	
	@Override
	public List<BoardVO> getList() {
		log.info("getList................");
		return mapper.getList();
	}
	
	@Override
	public BoardVO get(Long bno) {
		log.info("get..............");
		return mapper.read(bno);
	}

	@Override
	public boolean modify(BoardVO board) {
		log.info("modify.............");
		return mapper.update(board) == 1; //update í•˜ë©´ 1ì´ ë°˜í™˜ë˜ë‹ˆê¹ == 1ë¡œ true/false
	}

	@Override
	public boolean remove(Long bno) {
		log.info("remove.............");
		return mapper.delete(bno) == 1;
	}

	

}

```


org.zerock.controller/

- BoardController.java

```java
package org.zerock.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.zerock.domain.BoardVO;
import org.zerock.service.BoardService;

import lombok.AllArgsConstructor;
import lombok.extern.log4j.Log4j;

@Controller
@RequestMapping("/board/*")
@Log4j
@AllArgsConstructor
public class BoardController {
	
	private BoardService service;
	
//	http://localhost:8081/board/register
	@GetMapping("/register")
	public void register() {
		
	}
	
	@PostMapping("/register")
	public String register(BoardVO board) {
		service.register(board);
		
		return "redirect:/board/list"; //listë§Œ ì“°ë©´ ì•ˆë˜ëŠ” ì´ìœ : ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ í†µí•´ URL ë³€ê²½ + ì¤‘ë³µ ì œì¶œ ë°©ì§€(PRG íŒ¨í„´)ë¥¼ ìœ„í•´ì„œ
		
	}
	
//	http://localhost:8081/board/list
	@GetMapping("/list")
	public void list(Model model) {
		model.addAttribute("list", service.getList());
		
	}
	
	@GetMapping("/get")
	public void get(@RequestParam("bno") Long bno, Model model) {
		model.addAttribute("board", service.get(bno));
	}
	
//	modify, delete ìŠ¤ìŠ¤ë¡œ
	@GetMapping("/modify")
	public void modify(@RequestParam("bno") Long bno, Model model) {
		model.addAttribute("board", service.get(bno));
	}
	
	
	@PostMapping("/modify")
	public String modify(BoardVO board) {
		
		if(service.modify(board)) {
			return "redirect:/board/list";	
		}
		return "redirect:/board/get";
	}
	@PostMapping("/remove")
	public String remove(@RequestParam("bno") Long bno, BoardVO board) {
		if(service.remove(bno)) {
			return "redirect:/board/list";
		}
		return "redirect:/board/get";
	}
}

```

- web.xml
```
<filter>
		<filter-name>encoding</filter-name>
		<filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
		<init-param>
			<param-name>encoding</param-name>
			<param-value>UTF-8</param-value>
		</init-param>
	</filter>
	
	<filter-mapping>
		<filter-name>encoding</filter-name>
		<servlet-name>appServlet</servlet-name>
	</filter-mapping>
	
ì¶”ê°€
```
